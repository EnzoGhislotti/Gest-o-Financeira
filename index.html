<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíé Finance Pro - Gest√£o Financeira Moderna</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíé</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8B5CF6;
            --primary-dark: #7C3AED;
            --primary-light: #A78BFA;
            --secondary: #EC4899;
            --accent: #06B6D4;
            
            --bg-primary: #0F0F23;
            --bg-secondary: #1A1A2E;
            --bg-tertiary: #16213E;
            --bg-card: #1E1E3F;
            
            --text-primary: #F3F4F6;
            --text-secondary: #9CA3AF;
            --text-muted: #6B7280;
            
            --success: #10B981;
            --success-light: rgba(16, 185, 129, 0.1);
            --warning: #F59E0B;
            --warning-light: rgba(245, 158, 11, 0.1);
            --danger: #EF4444;
            --danger-light: rgba(239, 68, 68, 0.1);
            --info: #3B82F6;
            
            --border: #2D2D4A;
            --shadow: rgba(139, 92, 246, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .logo {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            font-size: 1.8rem;
        }

        .logo p {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .nav {
            flex: 1;
            padding: 1.5rem 0;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(139, 92, 246, 0.1);
            color: var(--primary-light);
        }

        .nav-item.active {
            background: rgba(139, 92, 246, 0.15);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-icon {
            font-size: 1.25rem;
        }

        .user-section {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .user-details {
            flex: 1;
            overflow: hidden;
        }

        .user-name {
            font-size: 0.875rem;
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .user-email {
            font-size: 0.75rem;
            color: var(--text-muted);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sync-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: var(--success-light);
            color: var(--success);
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .btn-logout {
            width: 100%;
            padding: 0.65rem;
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
            max-width: 1600px;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-change {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .form-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Card Item (for lists) */
        .credit-card-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .credit-card-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .card-item-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .card-item-brand {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .card-limit-bar {
            margin: 1rem 0;
        }

        .card-limit-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Transaction Item */
        .transaction-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .transaction-icon.income {
            background: var(--success-light);
            color: var(--success);
        }

        .transaction-icon.expense {
            background: var(--danger-light);
            color: var(--danger);
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .transaction-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .transaction-amount {
            font-size: 1.125rem;
            font-weight: 700;
        }

        .transaction-amount.income {
            color: var(--success);
        }

        .transaction-amount.expense {
            color: var(--danger);
        }

        /* Budget Item */
        .budget-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .budget-category {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .budget-amounts {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        /* Goal Item */
        .goal-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .goal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .goal-deadline {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .goal-progress {
            margin: 1rem 0;
        }

        .goal-amounts {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        /* Installment Item */
        .installment-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .installment-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .installment-title {
            font-size: 1.125rem;
            font-weight: 700;
        }

        .installment-monthly {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--danger);
        }

        .installment-dots {
            display: flex;
            gap: 0.35rem;
            margin: 0.75rem 0;
        }

        .installment-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border);
        }

        .installment-dot.paid {
            background: var(--success);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1.25rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .loading::after {
            content: '...';
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <!-- Login/Setup Screen -->
    <div id="setup-screen" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 2rem;">
        <div class="card" style="max-width: 500px; width: 100%;">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üíé</div>
                <h1 class="page-title" style="justify-content: center;">Finance Pro</h1>
                <p class="page-subtitle">Gest√£o financeira moderna e inteligente</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" id="setup-email" class="form-input" placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label class="form-label">Senha</label>
                <input type="password" id="setup-password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            
            <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.75rem;" onclick="login()">
                Entrar
            </button>
            <button class="btn btn-secondary" style="width: 100%;" onclick="register()">
                Criar Conta
            </button>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <button class="btn btn-secondary" onclick="loginWithGoogle()">
                    <span>üîê</span>
                    Entrar com Google
                </button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <h1>
                    <span class="logo-icon">üíé</span>
                    Finance Pro
                </h1>
                <p>Gest√£o financeira moderna</p>
            </div>

            <nav class="nav">
                <div class="nav-item active" onclick="showPage('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showPage('cards')">
                    <span class="nav-icon">üí≥</span>
                    <span>Meus Cart√µes</span>
                </div>
                <div class="nav-item" onclick="showPage('installments')">
                    <span class="nav-icon">üì±</span>
                    <span>Minhas Parcelas</span>
                </div>
                <div class="nav-item" onclick="showPage('budget')">
                    <span class="nav-icon">üí∞</span>
                    <span>Or√ßamentos</span>
                </div>
                <div class="nav-item" onclick="showPage('transactions')">
                    <span class="nav-icon">üí∏</span>
                    <span>Transa√ß√µes</span>
                </div>
                <div class="nav-item" onclick="showPage('planning')">
                    <span class="nav-icon">üéØ</span>
                    <span>Planejamento</span>
                </div>
                <div class="nav-item" onclick="showPage('insights')">
                    <span class="nav-icon">üß†</span>
                    <span>Insights</span>
                </div>
            </nav>

            <div class="user-section">
                <div class="sync-badge">
                    <span>‚úì</span>
                    <span>Sincronizado</span>
                </div>
                <div class="user-info">
                    <div class="user-avatar">üë§</div>
                    <div class="user-details">
                        <div class="user-name" id="user-name">Usu√°rio</div>
                        <div class="user-email" id="user-email">usuario@email.com</div>
                    </div>
                </div>
                <button class="btn-logout" onclick="logout()">Sair</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h1 class="page-title">
                        <span>üìä</span>
                        Vis√£o Geral
                    </h1>
                    <p class="page-subtitle">Seu resumo financeiro completo</p>
                </div>

                <div class="stats-grid" id="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-label">Saldo Total</div>
                        <div class="stat-value" id="total-balance">R$ 0,00</div>
                        <div class="stat-change">Soma de todos os cart√µes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Receitas do M√™s</div>
                        <div class="stat-value" id="total-income">R$ 0,00</div>
                        <div class="stat-change positive" id="income-change">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Despesas do M√™s</div>
                        <div class="stat-value" id="total-expenses">R$ 0,00</div>
                        <div class="stat-change negative" id="expense-change">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Parcelas Ativas</div>
                        <div class="stat-value" id="active-installments">0</div>
                        <div class="stat-change" id="installments-monthly">R$ 0/m√™s</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>üí≥</span>
                                Meus Cart√µes
                            </h2>
                        </div>
                        <div id="dashboard-cards-preview">
                            <div class="empty-state">
                                <p style="font-size: 0.9rem;">Adicione cart√µes na aba "Meus Cart√µes"</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>üì±</span>
                                Parcelas Ativas
                            </h2>
                        </div>
                        <div id="dashboard-installments-preview">
                            <div class="empty-state">
                                <p style="font-size: 0.9rem;">Nenhuma parcela ativa</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>üí∞</span>
                                Or√ßamentos
                            </h2>
                        </div>
                        <div id="dashboard-budget-preview">
                            <div class="empty-state">
                                <p style="font-size: 0.9rem;">Configure na aba "Or√ßamentos"</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards Page -->
            <div id="cards" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <span>üí≥</span>
                        Meus Cart√µes
                    </h1>
                    <p class="page-subtitle">Gerencie seus cart√µes de cr√©dito e d√©bito</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Adicionar Novo Cart√£o</h2>
                    </div>
                    <form id="card-form" onsubmit="addCard(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nome do Cart√£o</label>
                                <input type="text" id="card-name" class="form-input" placeholder="Ex: Nubank Roxo" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Limite de Cr√©dito (R$)</label>
                                <input type="number" id="card-limit" class="form-input" placeholder="0,00" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Saldo D√©bito/Pix (R$)</label>
                                <input type="number" id="card-balance" class="form-input" placeholder="0,00" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bandeira</label>
                                <select id="card-brand" class="form-select" required>
                                    <option value="Visa">Visa</option>
                                    <option value="Mastercard">Mastercard</option>
                                    <option value="Elo">Elo</option>
                                    <option value="American Express">American Express</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>+</span>
                            Adicionar Cart√£o
                        </button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Seus Cart√µes</h2>
                    </div>
                    <div id="cards-list"></div>
                </div>
            </div>

            <!-- Installments Page -->
            <div id="installments" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <span>üì±</span>
                        Minhas Parcelas
                    </h1>
                    <p class="page-subtitle">Acompanhe suas compras parceladas</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Compras Ativas</div>
                        <div class="stat-value" id="inst-active">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Parcelas Pendentes</div>
                        <div class="stat-value" id="inst-pending">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Valor Mensal Total</div>
                        <div class="stat-value" id="inst-monthly">R$ 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Comprometimento</div>
                        <div class="stat-value" id="inst-commitment">0%</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Suas Parcelas</h2>
                    </div>
                    <div id="installments-list"></div>
                </div>
            </div>

            <!-- Budget Page -->
            <div id="budget" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <span>üí∞</span>
                        Or√ßamentos
                    </h1>
                    <p class="page-subtitle">Defina limites de gastos por categoria</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Criar Or√ßamento</h2>
                    </div>
                    <form id="budget-form" onsubmit="addBudget(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Categoria</label>
                                <select id="budget-category" class="form-select" required>
                                    <option value="Alimenta√ß√£o">üçî Alimenta√ß√£o</option>
                                    <option value="Transporte">üöó Transporte</option>
                                    <option value="Moradia">üè† Moradia</option>
                                    <option value="Sa√∫de">üíä Sa√∫de</option>
                                    <option value="Educa√ß√£o">üìö Educa√ß√£o</option>
                                    <option value="Lazer">üéÆ Lazer</option>
                                    <option value="Compras">üõçÔ∏è Compras</option>
                                    <option value="Outros">üì¶ Outros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Limite Mensal (R$)</label>
                                <input type="number" id="budget-limit" class="form-input" placeholder="0,00" step="0.01" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>+</span>
                            Criar Or√ßamento
                        </button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Seus Or√ßamentos</h2>
                    </div>
                    <div id="budgets-list"></div>
                </div>
            </div>

            <!-- Transactions Page -->
            <div id="transactions" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <span>üí∏</span>
                        Transa√ß√µes
                    </h1>
                    <p class="page-subtitle">Hist√≥rico completo de movimenta√ß√µes</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Nova Transa√ß√£o</h2>
                    </div>
                    <form id="transaction-form" onsubmit="addTransaction(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Tipo</label>
                                <select id="trans-type" class="form-select" required onchange="updateTransactionForm()">
                                    <option value="expense">Despesa</option>
                                    <option value="income">Receita</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Descri√ß√£o</label>
                                <input type="text" id="trans-desc" class="form-input" placeholder="Ex: Supermercado" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Valor (R$)</label>
                                <input type="number" id="trans-amount" class="form-input" placeholder="0,00" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Categoria</label>
                                <select id="trans-category" class="form-select" required>
                                    <optgroup label="Despesas">
                                        <option value="Alimenta√ß√£o">üçî Alimenta√ß√£o</option>
                                        <option value="Transporte">üöó Transporte</option>
                                        <option value="Moradia">üè† Moradia</option>
                                        <option value="Sa√∫de">üíä Sa√∫de</option>
                                        <option value="Educa√ß√£o">üìö Educa√ß√£o</option>
                                        <option value="Lazer">üéÆ Lazer</option>
                                        <option value="Compras">üõçÔ∏è Compras</option>
                                        <option value="Outros">üì¶ Outros</option>
                                    </optgroup>
                                    <optgroup label="Receitas">
                                        <option value="Sal√°rio">üíº Sal√°rio</option>
                                        <option value="Freelance">üíª Freelance</option>
                                        <option value="Investimentos">üìà Investimentos</option>
                                        <option value="Outros">üì¶ Outros</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group" id="trans-card-group">
                                <label class="form-label">Cart√£o</label>
                                <select id="trans-card" class="form-select" required>
                                    <option value="">Selecione um cart√£o</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data</label>
                                <input type="date" id="trans-date" class="form-input" required>
                            </div>
                        </div>
                        
                        <div class="form-checkbox" id="trans-installment-check">
                            <input type="checkbox" id="trans-installment" onchange="toggleInstallmentFields()">
                            <label for="trans-installment">Parcelar esta compra</label>
                        </div>

                        <div id="installment-fields" style="display: none;">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">N√∫mero de Parcelas</label>
                                    <input type="number" id="trans-inst-number" class="form-input" min="2" max="48" value="2">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Data da 1¬™ Parcela</label>
                                    <input type="date" id="trans-inst-date" class="form-input">
                                </div>
                            </div>
                            <div id="installment-preview" style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 1rem;"></div>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <span>+</span>
                            Adicionar Transa√ß√£o
                        </button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Hist√≥rico</h2>
                    </div>
                    <div class="form-grid" style="margin-bottom: 1.5rem;">
                        <select id="trans-filter-month" class="form-select" onchange="renderTransactions()">
                            <option value="all">Todos os meses</option>
                        </select>
                        <select id="trans-filter-type" class="form-select" onchange="renderTransactions()">
                            <option value="all">Todos os tipos</option>
                            <option value="income">Receitas</option>
                            <option value="expense">Despesas</option>
                        </select>
                        <select id="trans-filter-card" class="form-select" onchange="renderTransactions()">
                            <option value="all">Todos os cart√µes</option>
                        </select>
                    </div>
                    <div id="transactions-list"></div>
                </div>
            </div>

            <!-- Planning Page -->
            <div id="planning" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <span>üéØ</span>
                        Planejamento
                    </h1>
                    <p class="page-subtitle">Defina metas e objetivos financeiros</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Nova Meta</h2>
                    </div>
                    <form id="goal-form" onsubmit="addGoal(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nome da Meta</label>
                                <input type="text" id="goal-name" class="form-input" placeholder="Ex: Viagem Europa" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Valor Objetivo (R$)</label>
                                <input type="number" id="goal-target" class="form-input" placeholder="0,00" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Valor Atual (R$)</label>
                                <input type="number" id="goal-current" class="form-input" placeholder="0,00" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data Prevista</label>
                                <input type="date" id="goal-date" class="form-input" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>+</span>
                            Criar Meta
                        </button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Suas Metas</h2>
                    </div>
                    <div id="goals-list"></div>
                </div>
            </div>

            <!-- Insights Page -->
            <div id="insights" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <span>üß†</span>
                        Insights
                    </h1>
                    <p class="page-subtitle">An√°lises inteligentes do seu comportamento financeiro</p>
                </div>

                <div id="insights-content"></div>
            </div>
        </main>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
  apiKey: "AIzaSyDIaCERQG7n5LY4RmvBvbUns5CcnyjO1Lw",
  authDomain: "financas-5c7b4.firebaseapp.com",
  databaseURL: "https://financas-5c7b4-default-rtdb.firebaseio.com",
  projectId: "financas-5c7b4",
  storageBucket: "financas-5c7b4.firebasestorage.app",
  messagingSenderId: "598951471840",
  appId: "1:598951471840:web:a2d70757f28d8ee9edfe85"
};

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let currentUser = null;
        let cards = [];
        let transactions = [];
        let budgets = [];
        let goals = [];

        // Auth Functions
        function login() {
            const email = document.getElementById('setup-email').value;
            const password = document.getElementById('setup-password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then(() => console.log('Login successful'))
                .catch(error => alert('Erro ao fazer login: ' + error.message));
        }

        function register() {
            const email = document.getElementById('setup-email').value;
            const password = document.getElementById('setup-password').value;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => console.log('Conta criada com sucesso'))
                .catch(error => alert('Erro ao criar conta: ' + error.message));
        }

        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .catch(error => alert('Erro ao fazer login com Google: ' + error.message));
        }

        function logout() {
            auth.signOut();
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('setup-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'flex';
                document.getElementById('user-name').textContent = user.displayName || 'Usu√°rio';
                document.getElementById('user-email').textContent = user.email;
                document.getElementById('trans-date').valueAsDate = new Date();
                loadUserData();
            } else {
                currentUser = null;
                document.getElementById('setup-screen').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
            }
        });

        // Load Data
        function loadUserData() {
            const userId = currentUser.uid;
            
            database.ref(`users/${userId}/cards`).on('value', snapshot => {
                cards = [];
                snapshot.forEach(child => {
                    cards.push({ id: child.key, ...child.val() });
                });
                renderCards();
                updateCardSelectors();
                updateDashboard();
            });

            database.ref(`users/${userId}/transactions`).on('value', snapshot => {
                transactions = [];
                snapshot.forEach(child => {
                    transactions.push({ id: child.key, ...child.val() });
                });
                renderTransactions();
                populateMonthFilters();
                updateDashboard();
                renderInstallments();
            });

            database.ref(`users/${userId}/budgets`).on('value', snapshot => {
                budgets = [];
                snapshot.forEach(child => {
                    budgets.push({ id: child.key, ...child.val() });
                });
                renderBudgets();
                updateDashboard();
            });

            database.ref(`users/${userId}/goals`).on('value', snapshot => {
                goals = [];
                snapshot.forEach(child => {
                    goals.push({ id: child.key, ...child.val() });
                });
                renderGoals();
            });
        }

        // Save Functions
        function saveToCloud() {
            // Data is saved in real-time via Firebase listeners
        }

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');

            if (pageId === 'dashboard') updateDashboard();
            if (pageId === 'insights') generateInsights();
        }

        // Utility Functions
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        // Cards Functions
        function addCard(event) {
            event.preventDefault();
            
            const card = {
                name: document.getElementById('card-name').value,
                limit: parseFloat(document.getElementById('card-limit').value),
                balance: parseFloat(document.getElementById('card-balance').value),
                brand: document.getElementById('card-brand').value,
                used: 0
            };

            database.ref(`users/${currentUser.uid}/cards`).push(card);
            document.getElementById('card-form').reset();
        }

        function renderCards() {
            const list = document.getElementById('cards-list');
            
            if (cards.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí≥</div><p>Nenhum cart√£o cadastrado ainda</p></div>';
                return;
            }

            list.innerHTML = cards.map(card => {
                const usedPercentage = (card.used / card.limit * 100).toFixed(1);
                const available = card.limit - card.used;
                
                return `
                    <div class="credit-card-item">
                        <div class="card-item-header">
                            <div>
                                <div class="card-item-title">${card.name}</div>
                                <div class="card-item-brand">${card.brand}</div>
                            </div>
                        </div>
                        
                        <div class="card-limit-bar">
                            <div class="card-limit-label">
                                <span>Cr√©dito: ${formatCurrency(available)} dispon√≠vel</span>
                                <span>${usedPercentage}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${usedPercentage}%"></div>
                            </div>
                            <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
                                Limite total: ${formatCurrency(card.limit)}
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                            <div>
                                <div style="font-size: 0.875rem; color: var(--text-muted);">D√©bito/Pix</div>
                                <div style="font-size: 1.125rem; font-weight: 700;">${formatCurrency(card.balance)}</div>
                            </div>
                        </div>
                        
                        <div class="card-actions">
                            <button class="btn btn-sm btn-danger" onclick="deleteCard('${card.id}')">
                                <span>üóëÔ∏è</span>
                                Excluir
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteCard(id) {
            if (confirm('Deseja excluir este cart√£o?')) {
                database.ref(`users/${currentUser.uid}/cards/${id}`).remove();
            }
        }

        function updateCardSelectors() {
            const selectors = [
                document.getElementById('trans-card'),
                document.getElementById('trans-filter-card')
            ];

            selectors.forEach(select => {
                if (!select) return;
                
                const currentValue = select.value;
                const isFilter = select.id.includes('filter');
                
                select.innerHTML = isFilter ? 
                    '<option value="all">Todos os cart√µes</option>' : 
                    '<option value="">Selecione um cart√£o</option>';
                
                cards.forEach(card => {
                    select.innerHTML += `<option value="${card.id}">${card.name}</option>`;
                });
                
                select.value = currentValue;
            });
        }

        // Transactions Functions
        function updateTransactionForm() {
            const type = document.getElementById('trans-type').value;
            const cardGroup = document.getElementById('trans-card-group');
            const installmentCheck = document.getElementById('trans-installment-check');
            
            if (type === 'expense') {
                cardGroup.style.display = 'block';
                installmentCheck.style.display = 'flex';
            } else {
                cardGroup.style.display = 'none';
                installmentCheck.style.display = 'none';
                document.getElementById('trans-installment').checked = false;
                toggleInstallmentFields();
            }
        }

        function toggleInstallmentFields() {
            const checked = document.getElementById('trans-installment').checked;
            const fields = document.getElementById('installment-fields');
            
            if (checked) {
                fields.style.display = 'block';
                document.getElementById('trans-inst-date').valueAsDate = new Date(document.getElementById('trans-date').value);
                updateInstallmentPreview();
            } else {
                fields.style.display = 'none';
            }
        }

        function updateInstallmentPreview() {
            const amount = parseFloat(document.getElementById('trans-amount').value) || 0;
            const installments = parseInt(document.getElementById('trans-inst-number').value) || 2;
            const preview = document.getElementById('installment-preview');
            
            if (amount > 0) {
                const installmentAmount = amount / installments;
                preview.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">
                        ${installments}x de ${formatCurrency(installmentAmount)}
                    </div>
                    <div style="font-size: 0.875rem; color: var(--text-muted);">
                        Total: ${formatCurrency(amount)}
                    </div>
                `;
            } else {
                preview.innerHTML = '<div style="color: var(--text-muted);">Preencha o valor</div>';
            }
        }

        function addTransaction(event) {
            event.preventDefault();
            
            const type = document.getElementById('trans-type').value;
            const amount = parseFloat(document.getElementById('trans-amount').value);
            const isInstallment = document.getElementById('trans-installment').checked;
            
            if (isInstallment && type === 'expense') {
                const installmentCount = parseInt(document.getElementById('trans-inst-number').value);
                const firstDate = new Date(document.getElementById('trans-inst-date').value);
                const installmentAmount = amount / installmentCount;
                const parentId = Date.now();
                
                for (let i = 0; i < installmentCount; i++) {
                    const installmentDate = new Date(firstDate);
                    installmentDate.setMonth(installmentDate.getMonth() + i);
                    
                    const transaction = {
                        type: type,
                        description: document.getElementById('trans-desc').value,
                        amount: installmentAmount,
                        category: document.getElementById('trans-category').value,
                        card: document.getElementById('trans-card').value,
                        date: installmentDate.toISOString().split('T')[0],
                        isInstallment: true,
                        installmentNumber: i + 1,
                        installmentTotal: installmentCount,
                        installmentParentId: parentId,
                        installmentOriginalAmount: amount
                    };
                    
                    database.ref(`users/${currentUser.uid}/transactions`).push(transaction);
                }
            } else {
                const transaction = {
                    type: type,
                    description: document.getElementById('trans-desc').value,
                    amount: amount,
                    category: document.getElementById('trans-category').value,
                    card: type === 'expense' ? document.getElementById('trans-card').value : '',
                    date: document.getElementById('trans-date').value
                };
                
                database.ref(`users/${currentUser.uid}/transactions`).push(transaction);
            }
            
            document.getElementById('transaction-form').reset();
            document.getElementById('trans-date').valueAsDate = new Date();
            document.getElementById('installment-fields').style.display = 'none';
        }

        function renderTransactions() {
            const list = document.getElementById('transactions-list');
            const monthFilter = document.getElementById('trans-filter-month').value;
            const typeFilter = document.getElementById('trans-filter-type').value;
            const cardFilter = document.getElementById('trans-filter-card').value;
            
            let filtered = transactions.filter(t => {
                if (monthFilter !== 'all' && !t.date.startsWith(monthFilter)) return false;
                if (typeFilter !== 'all' && t.type !== typeFilter) return false;
                if (cardFilter !== 'all' && t.card !== cardFilter) return false;
                return true;
            });
            
            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí∏</div><p>Nenhuma transa√ß√£o encontrada</p></div>';
                return;
            }
            
            const sorted = filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            list.innerHTML = sorted.map(t => {
                const card = cards.find(c => c.id === t.card);
                const cardName = card ? card.name : 'N/A';
                
                return `
                    <div class="transaction-item">
                        <div class="transaction-icon ${t.type}">
                            ${t.type === 'income' ? '‚Üë' : '‚Üì'}
                        </div>
                        <div class="transaction-details">
                            <div class="transaction-title">
                                ${t.description}
                                ${t.isInstallment ? `<span style="background: var(--primary-light); color: var(--bg-primary); padding: 0.125rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem;">${t.installmentNumber}/${t.installmentTotal}</span>` : ''}
                            </div>
                            <div class="transaction-meta">
                                ${t.category} ‚Ä¢ ${cardName} ‚Ä¢ ${formatDate(t.date)}
                            </div>
                        </div>
                        <div class="transaction-amount ${t.type}">
                            ${t.type === 'income' ? '+' : '-'} ${formatCurrency(t.amount)}
                        </div>
                        <button class="btn btn-sm btn-danger" onclick="deleteTransaction('${t.id}')">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
            }).join('');
        }

        function deleteTransaction(id) {
            if (confirm('Deseja excluir esta transa√ß√£o?')) {
                database.ref(`users/${currentUser.uid}/transactions/${id}`).remove();
            }
        }

        function populateMonthFilters() {
            const months = new Set();
            transactions.forEach(t => {
                const monthYear = t.date.substring(0, 7);
                months.add(monthYear);
            });
            
            const sorted = Array.from(months).sort().reverse();
            
            const select = document.getElementById('trans-filter-month');
            const currentValue = select.value;
            
            select.innerHTML = '<option value="all">Todos os meses</option>';
            sorted.forEach(month => {
                const [year, monthNum] = month.split('-');
                const date = new Date(year, monthNum - 1);
                const monthName = date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                select.innerHTML += `<option value="${month}">${monthName.charAt(0).toUpperCase() + monthName.slice(1)}</option>`;
            });
            
            select.value = currentValue;
        }

        // Budget Functions
        function addBudget(event) {
            event.preventDefault();
            
            const budget = {
                category: document.getElementById('budget-category').value,
                limit: parseFloat(document.getElementById('budget-limit').value),
                spent: 0
            };
            
            database.ref(`users/${currentUser.uid}/budgets`).push(budget);
            document.getElementById('budget-form').reset();
        }

        function renderBudgets() {
            const list = document.getElementById('budgets-list');
            
            if (budgets.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí∞</div><p>Nenhum or√ßamento criado ainda</p></div>';
                return;
            }
            
            list.innerHTML = budgets.map(budget => {
                const currentMonth = new Date().toISOString().substring(0, 7);
                const spent = transactions.filter(t => 
                    t.type === 'expense' && 
                    t.category === budget.category &&
                    t.date.startsWith(currentMonth)
                ).reduce((sum, t) => sum + t.amount, 0);
                
                const percentage = (spent / budget.limit * 100).toFixed(1);
                const remaining = budget.limit - spent;
                const status = percentage >= 100 ? 'danger' : percentage >= 80 ? 'warning' : 'success';
                
                return `
                    <div class="budget-item">
                        <div class="budget-header">
                            <div class="budget-category">${budget.category}</div>
                            <button class="btn btn-sm btn-danger" onclick="deleteBudget('${budget.id}')">
                                üóëÔ∏è
                            </button>
                        </div>
                        <div class="budget-amounts">
                            <span>${formatCurrency(spent)} de ${formatCurrency(budget.limit)}</span>
                            <span>${percentage}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%; background: var(--${status});"></div>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
                            ${remaining > 0 ? `Restam ${formatCurrency(remaining)}` : 'Or√ßamento excedido!'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteBudget(id) {
            if (confirm('Deseja excluir este or√ßamento?')) {
                database.ref(`users/${currentUser.uid}/budgets/${id}`).remove();
            }
        }

        // Goals Functions
        function addGoal(event) {
            event.preventDefault();
            
            const goal = {
                name: document.getElementById('goal-name').value,
                target: parseFloat(document.getElementById('goal-target').value),
                current: parseFloat(document.getElementById('goal-current').value),
                date: document.getElementById('goal-date').value
            };
            
            database.ref(`users/${currentUser.uid}/goals`).push(goal);
            document.getElementById('goal-form').reset();
        }

        function renderGoals() {
            const list = document.getElementById('goals-list');
            
            if (goals.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üéØ</div><p>Nenhuma meta criada ainda</p></div>';
                return;
            }
            
            list.innerHTML = goals.map(goal => {
                const percentage = (goal.current / goal.target * 100).toFixed(1);
                const remaining = goal.target - goal.current;
                const daysUntil = Math.ceil((new Date(goal.date) - new Date()) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="goal-item">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">${goal.name}</div>
                                <div class="goal-deadline">
                                    ${daysUntil > 0 ? `${daysUntil} dias restantes` : 'Prazo vencido'}
                                </div>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, var(--primary-light), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                                ${formatCurrency(goal.target)}
                            </div>
                        </div>
                        <div class="goal-progress">
                            <div class="goal-amounts">
                                <span>${formatCurrency(goal.current)} economizado</span>
                                <span>${percentage}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%"></div>
                            </div>
                            <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
                                Faltam ${formatCurrency(remaining)} para atingir sua meta
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; justify-content: center;">
                            <button class="btn btn-sm btn-success" onclick="updateGoalProgress('${goal.id}')">
                                Atualizar Progresso
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteGoal('${goal.id}')">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateGoalProgress(id) {
            const amount = prompt('Quanto voc√™ adicionou a esta meta?');
            if (amount && !isNaN(amount)) {
                const goal = goals.find(g => g.id === id);
                if (goal) {
                    database.ref(`users/${currentUser.uid}/goals/${id}/current`).set(goal.current + parseFloat(amount));
                }
            }
        }

        function deleteGoal(id) {
            if (confirm('Deseja excluir esta meta?')) {
                database.ref(`users/${currentUser.uid}/goals/${id}`).remove();
            }
        }

        // Installments Functions
        function renderInstallments() {
            const installmentGroups = {};
            transactions.filter(t => t.isInstallment).forEach(t => {
                if (!installmentGroups[t.installmentParentId]) {
                    installmentGroups[t.installmentParentId] = [];
                }
                installmentGroups[t.installmentParentId].push(t);
            });

            const today = new Date();
            const activeGroups = Object.values(installmentGroups).filter(group => 
                group.some(t => new Date(t.date) >= today)
            );

            const totalPending = activeGroups.reduce((sum, group) => {
                return sum + group.filter(t => new Date(t.date) >= today).length;
            }, 0);

            const monthlyTotal = activeGroups.reduce((sum, group) => {
                return sum + group[0].amount;
            }, 0);

            document.getElementById('inst-active').textContent = activeGroups.length;
            document.getElementById('inst-pending').textContent = totalPending;
            document.getElementById('inst-monthly').textContent = formatCurrency(monthlyTotal);
            
            const currentMonth = new Date().toISOString().substring(0, 7);
            const income = transactions.filter(t => t.type === 'income' && t.date.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.amount, 0);
            const commitment = income > 0 ? ((monthlyTotal / income) * 100).toFixed(1) : 0;
            document.getElementById('inst-commitment').textContent = commitment + '%';

            const list = document.getElementById('installments-list');
            
            if (activeGroups.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì±</div><p>Nenhuma parcela ativa no momento</p></div>';
                return;
            }

            list.innerHTML = activeGroups.map(group => {
                const sorted = group.sort((a, b) => a.installmentNumber - b.installmentNumber);
                const first = sorted[0];
                const paid = sorted.filter(t => new Date(t.date) < today).length;
                const percentage = (paid / first.installmentTotal * 100).toFixed(0);
                const remaining = first.installmentTotal - paid;
                const remainingAmount = remaining * first.amount;
                const nextInstallment = sorted.find(t => new Date(t.date) >= today);
                
                const card = cards.find(c => c.id === first.card);
                const cardName = card ? card.name : 'N/A';

                return `
                    <div class="installment-item">
                        <div class="installment-header">
                            <div>
                                <div class="installment-title">${first.description}</div>
                                <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.25rem;">
                                    ${cardName} ‚Ä¢ ${first.category}
                                </div>
                            </div>
                            <div class="installment-monthly">${formatCurrency(first.amount)}<span style="font-size: 0.875rem;">/m√™s</span></div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.875rem; margin-bottom: 0.5rem;">
                                <span>Paga ${paid}/${first.installmentTotal} parcelas</span>
                                <span>${percentage}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percentage}%"></div>
                            </div>
                            <div class="installment-dots">
                                ${Array.from({length: first.installmentTotal}, (_, i) => 
                                    `<div class="installment-dot ${i < paid ? 'paid' : ''}"></div>`
                                ).join('')}
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.75rem; font-size: 0.875rem;">
                            <span style="color: var(--text-muted);">
                                Faltam ${formatCurrency(remainingAmount)}
                            </span>
                            ${nextInstallment ? `<span style="color: var(--primary); font-weight: 600;">
                                Pr√≥xima: ${formatDate(nextInstallment.date)}
                            </span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Dashboard Functions
        function updateDashboard() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            // Total balance (sum of all card balances)
            const totalBalance = cards.reduce((sum, card) => sum + card.balance, 0);
            document.getElementById('total-balance').textContent = formatCurrency(totalBalance);
            
            // Income
            const income = transactions.filter(t => t.type === 'income' && t.date.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.amount, 0);
            document.getElementById('total-income').textContent = formatCurrency(income);
            
            // Expenses
            const expenses = transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.amount, 0);
            document.getElementById('total-expenses').textContent = formatCurrency(expenses);
            
            // Update card previews
            updateDashboardPreviews();
        }

        function updateDashboardPreviews() {
            // Cards preview
            const cardsPreview = document.getElementById('dashboard-cards-preview');
            if (cards.length === 0) {
                cardsPreview.innerHTML = '<div class="empty-state"><p style="font-size: 0.9rem;">Adicione cart√µes na aba "Meus Cart√µes"</p></div>';
            } else {
                const topCards = cards.slice(0, 3);
                cardsPreview.innerHTML = topCards.map(card => `
                    <div style="padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-weight: 600;">${card.name}</div>
                            <div style="font-size: 0.875rem; color: var(--text-muted);">${formatCurrency(card.balance)}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            // Installments preview
            const installmentGroups = {};
            transactions.filter(t => t.isInstallment).forEach(t => {
                if (!installmentGroups[t.installmentParentId]) {
                    installmentGroups[t.installmentParentId] = [];
                }
                installmentGroups[t.installmentParentId].push(t);
            });
            
            const today = new Date();
            const activeGroups = Object.values(installmentGroups).filter(group => 
                group.some(t => new Date(t.date) >= today)
            );
            
            const installmentsPreview = document.getElementById('dashboard-installments-preview');
            if (activeGroups.length === 0) {
                installmentsPreview.innerHTML = '<div class="empty-state"><p style="font-size: 0.9rem;">Nenhuma parcela ativa</p></div>';
            } else {
                const topInstallments = activeGroups.slice(0, 3);
                installmentsPreview.innerHTML = topInstallments.map(group => {
                    const sorted = group.sort((a, b) => a.installmentNumber - b.installmentNumber);
                    const first = sorted[0];
                    const paid = sorted.filter(t => new Date(t.date) < today).length;
                    
                    return `
                        <div style="padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600;">${first.description}</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">${paid}/${first.installmentTotal} pagas</div>
                                </div>
                                <div style="font-weight: 700; color: var(--danger);">${formatCurrency(first.amount)}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // Budgets preview
            const budgetPreview = document.getElementById('dashboard-budget-preview');
            if (budgets.length === 0) {
                budgetPreview.innerHTML = '<div class="empty-state"><p style="font-size: 0.9rem;">Configure na aba "Or√ßamentos"</p></div>';
            } else {
                const currentMonth = new Date().toISOString().substring(0, 7);
                const topBudgets = budgets.slice(0, 3);
                budgetPreview.innerHTML = topBudgets.map(budget => {
                    const spent = transactions.filter(t => 
                        t.type === 'expense' && 
                        t.category === budget.category &&
                        t.date.startsWith(currentMonth)
                    ).reduce((sum, t) => sum + t.amount, 0);
                    const percentage = (spent / budget.limit * 100).toFixed(0);
                    
                    return `
                        <div style="padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div style="font-weight: 600;">${budget.category}</div>
                                <div style="font-size: 0.875rem;">${percentage}%</div>
                            </div>
                            <div class="progress-bar" style="height: 6px;">
                                <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%; background: ${percentage >= 100 ? 'var(--danger)' : percentage >= 80 ? 'var(--warning)' : 'var(--success)'};"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Insights Functions
        function generateInsights() {
            const content = document.getElementById('insights-content');
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            const income = transactions.filter(t => t.type === 'income' && t.date.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expenses;
            const savingsRate = income > 0 ? ((balance / income) * 100).toFixed(1) : 0;
            
            let insights = [];
            
            // Savings rate
            if (savingsRate >= 30) {
                insights.push({
                    icon: '‚úÖ',
                    title: 'Excelente Taxa de Poupan√ßa',
                    text: `Voc√™ est√° economizando ${savingsRate}% da sua renda! Continue assim!`,
                    type: 'success'
                });
            } else if (savingsRate >= 20) {
                insights.push({
                    icon: 'üëç',
                    title: 'Boa Taxa de Poupan√ßa',
                    text: `Voc√™ est√° economizando ${savingsRate}% da sua renda. Tente aumentar para 30%!`,
                    type: 'info'
                });
            } else if (savingsRate > 0) {
                insights.push({
                    icon: '‚ö†Ô∏è',
                    title: 'Taxa de Poupan√ßa Pode Melhorar',
                    text: `Voc√™ est√° economizando apenas ${savingsRate}%. Tente reduzir gastos n√£o essenciais.`,
                    type: 'warning'
                });
            } else {
                insights.push({
                    icon: 'üö®',
                    title: 'Aten√ß√£o: Sem Poupan√ßa',
                    text: 'Suas despesas est√£o iguais ou maiores que sua renda. Revise seus gastos!',
                    type: 'danger'
                });
            }
            
            // Category analysis
            const categoryExpenses = {};
            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth)).forEach(t => {
                categoryExpenses[t.category] = (categoryExpenses[t.category] || 0) + t.amount;
            });
            
            const topCategory = Object.entries(categoryExpenses).sort((a, b) => b[1] - a[1])[0];
            if (topCategory) {
                const percentage = (topCategory[1] / expenses * 100).toFixed(1);
                insights.push({
                    icon: 'üìä',
                    title: `Maior Gasto: ${topCategory[0]}`,
                    text: `${topCategory[0]} representa ${percentage}% das suas despesas (${formatCurrency(topCategory[1])}). ${percentage > 40 ? 'Considere reduzir.' : 'Dentro do esperado.'}`,
                    type: percentage > 40 ? 'warning' : 'info'
                });
            }
            
            // Card usage
            const cardUsage = {};
            transactions.filter(t => t.type === 'expense' && t.card && t.date.startsWith(currentMonth)).forEach(t => {
                cardUsage[t.card] = (cardUsage[t.card] || 0) + t.amount;
            });
            
            const topCard = Object.entries(cardUsage).sort((a, b) => b[1] - a[1])[0];
            if (topCard) {
                const card = cards.find(c => c.id === topCard[0]);
                if (card) {
                    const totalCardExpenses = Object.values(cardUsage).reduce((sum, v) => sum + v, 0);
                    const percentage = (topCard[1] / totalCardExpenses * 100).toFixed(1);
                    insights.push({
                        icon: 'üí≥',
                        title: `Cart√£o Mais Usado: ${card.name}`,
                        text: `${percentage}% das suas despesas foram feitas com ${card.name} (${formatCurrency(topCard[1])}).`,
                        type: 'info'
                    });
                }
            }
            
            if (insights.length === 0) {
                content.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üß†</div><p>Adicione transa√ß√µes para gerar insights</p></div>';
            } else {
                content.innerHTML = insights.map(insight => `
                    <div class="card" style="border-left: 4px solid var(--${insight.type});">
                        <div style="display: flex; gap: 1rem;">
                            <div style="font-size: 2rem;">${insight.icon}</div>
                            <div>
                                <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: 0.5rem;">${insight.title}</div>
                                <div style="color: var(--text-secondary);">${insight.text}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Initialize
        document.getElementById('trans-amount').addEventListener('input', updateInstallmentPreview);
        document.getElementById('trans-inst-number').addEventListener('input', updateInstallmentPreview);
        updateTransactionForm();
    </script>
</body>
</html>
